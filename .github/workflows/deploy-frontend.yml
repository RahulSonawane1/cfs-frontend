      - name: Prepare SSH
        run: |
          mkdir -p ~/.ssh
          echo "${{ secrets.SSH_PRIVATE_KEY }}" > ~/.ssh/id_rsa
          chmod 600 ~/.ssh/id_rsa
          # add host key to known_hosts
          ssh-keyscan -p "${{ secrets.SSH_PORT }}" -H "${{ secrets.SSH_HOST }}" >> ~/.ssh/known_hosts
        shell: bash

      - name: Check SSH connectivity (verbose)
        run: |
          echo "=== SSH debug: try simple command ==="
          ssh -vvv -i ~/.ssh/id_rsa -p "${{ secrets.SSH_PORT }}" -o StrictHostKeyChecking=no "${{ secrets.SSH_USER }}@${{ secrets.SSH_HOST }}" 'echo REMOTE OK; id; uname -a; ls -ld "${{ secrets.REMOTE_DIR_FRONTEND }}" || echo "no target dir"'
        shell: bash

      - name: Rsync to server
        run: |
          rsync -e "ssh -i ~/.ssh/id_rsa -p ${{ secrets.SSH_PORT }}" -az --delete dist/ "${{ secrets.SSH_USER }}@${{ secrets.SSH_HOST }}:${{ secrets.REMOTE_DIR_FRONTEND }}/"
        shell: bash
